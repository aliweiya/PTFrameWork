<script type = "text/javascript" src = "__PUBLIC__/script/angular.js"></script>
<script type = "text/javascript" src = "__PUBLIC__/script/angular.init.js"></script>
<div class = "pt-table-wrap" ng-app = "ptcms">
    <h4 class = "pt-msg-title"><b class = "f-fl">{$menuinfo.menu.name}管理</b></h4>
    <div class = "pt-list" ng-controller = "showlist">
        <form method = "post" action = "__URL__/multi">
        <div class = "pt-list-header">
                <div class = "pt-list-operate f-fl">
                    <a class = "btn btn-success btn-sm" href = '__URL__/add'>添加</a>
                    <input type = "submit" class = "btn btn-primary btn-sm" value = "排序" name = "reorder">
                </div>
            <div class = "f-fr">
                <select class = "input-box">
                    <option value = "title">名称</option>
                </select>
                <input ng-model = 'keyword' class = "input-text w160" type = "text" />
                <input type = "submit" class = "btn btn-default btn-sm" value = "搜索" />
            </div>
            <div class = "f-clear"></div>
        </div>
            <table class = "pt-list-table">
                <thead>
                <tr>
                    <th class = "f-tal">节点名称</th>
                    <th style = "width: 80px">模块</th>
                    <th style = "width: 80px">控制器</th>
                    <th style = "width: 80px">方法</th>
                    <th class = "w-word3">排序</th>
                    <th class = "w-word3">状态</th>
                    <th class = "operate w-operate3">操作</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat = "loop in lists | filter:keyword">
                    <td class = "f-tal">{{loop.showname}}</td>
                    <td>{{loop.module}}</td>
                    <td>{{loop.controller}}</td>
                    <td>{{loop.action}}</td>
                    <td>
                        <input type = "text" name = "ordernum[{{loop.id}}]" value = " {{loop.ordernum}}" class = "input-text" style = "width:100px;" />
                    </td>
                    <td>
                        <span class = "label label-warning" ng-if = "loop.status==0" ng-click = "changestatus($index,1)">隐藏</span>
                        <span class = "label label-success" ng-if = "loop.status==1" ng-click = "changestatus($index,0)">显示</span>
                    </td>
                    <td class = "operate">
                        <a ng-href = "{{loop.url_son}}"><i class = "icon icon-plus"></i>子类</a>
                        <a ng-href = "{{loop.url_edit}}"><i class = "icon icon-edit"></i>编辑</a>
                        <a ng-href = "javascript:;" ng-click = "del($index)"><i class = "icon icon-trash"></i>删除</a>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class = "pt-list-footer">
                <div class = "pt-list-operate f-fl">
                    <a class = "btn btn-success btn-sm" href = '__URL__/add'>添加</a>
                    <input type = "submit" class = "btn btn-primary btn-sm" value = "排序" name = "reorder">
                </div>
                <div class = "pt-page f-fr">
                    {$pagestr}
                </div>
                <div class = "f-clear"></div>
            </div>
        </form>
    </div>
</div>
<script type = "text/javascript">
    function showlist($scope, $http) {
        $scope.lists = $.parseJSON('{$list|json_encode}');
        $scope.changestatus = function (id, value) {
            var param = {
                'changestatus': '修改状态',
                'id[]': $scope.lists[id].id,
                'value[]': value
            };
            console.log(param);
            $http.post('__URL__/multi', param).success(function (res) {
                if (res.status == 1) {
                    $scope.lists[id].status = value;
                } else {
                    alert(res.info);
                }
            });
        };
        $scope.del = function (id) {
            var param={'id':id};
            $http.post('__URL__/del', param).success(function (res) {
                if (res.status == 1) {
                    $scope.lists.splice(id, 1);
                } else {
                    alert(res.info);
                }
            });
        };
    }
</script>